<link rel="import"
      href="../bower_components/polymer/polymer.html">
  <link rel="import" href="./imagine-instance.html">
  <link rel="import" href="./gm-cow-core.html">

 
<dom-module id="imagine-score">
  <style>
.score {
    width: 20%;
    height: 50%;
    font-size: 50px;
    border:rgba(58,51,53,200) solid 1px;
    margin: 5px;
    align-self: center;
}

#scoreHeader {
    height: 30%;
    background:rgba(58,51,53,200);
    color: white;
    font-size: 30px;
    display: flex;
    justify-content: flex-end;
    flex-direction: column;
}
#scoreScherm {
    position: absolute;
    top: 30%;
    bottom: 120px;
    left: 10px;
    right: 10px;
    display: flex;
    justify-content: center;
    flex-direction: row-reverse;
}
.content {
    
    padding: 50px;
}
imagine-score, .imagine-score {
    font-family: "Avenir LT W01 65 Medium", sans-serif;
  }
.nextplayer {
    width: 150px;
    height: 100px;
    position: absolute;
    bottom: 10px;
    right: 10px;
    font-size: 30px;
    text-align: center;
    line-height: 3.2;
    -moz-box-shadow:    2px 2px 5px 0px #3A3335;
  -webkit-box-shadow: 2px 2px 5px 0px #3A3335;
  box-shadow:         2px 2px 5px 0px #3A3335;
}
:host[scenario=communicity] .nextplayer{
background:#FFD979;
}
:host[scenario=sprawlville] .nextplayer {
background:#E6215B;
}
:host[scenario=renewabad] .nextplayer {
background:#3ABBA0;
}
:host[scenario=planopolis] .nextplayer {
background:#4CC0D0;
}
  </style>
  <template>
  <div id="scoreHeader"><div class="content">SCORES</div></div>
  <div id="scoreScherm">
  <template is='dom-repeat'  items="{{instances}}">
  <imagine-instance id="instance"  core="{{core}}" team="[[item.team]]" scenario="[[scenario]]" score="{{item.score}}"></imagine-instance>
    <!-- local DOM for your element -->
  <div class="score"><div>{{item.team}}</div> <div>score:<span>{{item.score}}</span></div><div>stemmen:<span>{{calcVotes(item.score)}}</span></div></div>
  </template>
  </div>
  <div class="nextplayer" on-click="nextPlayer">{{nextTeam}}</div>
  </template>
</dom-module>

<script>
  // register a new element called proto-element
  Polymer({
    
    is: "imagine-score",
    properties: {
        team: {
            type: String        
        },
        teams: {
            type: Array        
        },
        scenario: {
            type: String
        },
        score: {
            type: Number
            },
        core: {
            type: Object
        }
        
    },    
    behaviors: [
     
    ],
 observers: [
     
    ],
    calcVotes: function(score){
        return Math.round(score*.75);
    },
    ready: function() {
         this.cowconfig ={
            key: 'imagine',
            protocol:'wss',
            url:'websocket.geodan.nl', 
            port:443,
            dir: 'imagine'
          };
        var hash = window.location.hash.split('#')[1];
        if(parseInt(hash)&&hash <3 && hash >= 0) {
            hash++
        }
        else if(hash == 3) hash = 0;
        else hash = 1;
        this.hash = hash;
        this.nextTeam = this.teams[hash];
         this.instances = [
            {team:this.teams[0]},
            {team:this.teams[1]},
            {team:this.teams[2]},
            {team:this.teams[3]}
        
        ]
        switch(hash){
            case 1:
              this.instances.splice(1,3)
              break;
            case 2:
              this.instances.splice(2,2)
              break;
            case 3:
              this.instances.splice(3,1)
              break;
        }
       
    },
    
    nextPlayer: function() {
        var url = window.location.origin + window.location.pathname + '#'+this.hash;
        window.location.href = url;
        window.location.reload();
    }
    
  });
</script>