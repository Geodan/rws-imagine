<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-material/paper-material.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-toggle-button/paper-toggle-button.html">

<script src="../bower_components/d3/d3.js"></script>
<style>

.hidden {
	display: none;
}

.menu {
	fill: orange;
	stroke: orange;
}
.event {
	position: absolute;
	width: 200px;
	color: black;
	padding: 2px;
	background: white;
}

.event_org {
	position: absolute;
	width: 200px;
	color: black;
	padding: 2px;
	background: #ccffcc;
}
</style>
<dom-module id="imagine-reviewboard">

<style>
.title {
	font-family: 'Roboto', 'Noto', sans-serif;
}

.line {
    margin-left: 20px;
    font-family: 'Roboto', 'Noto', sans-serif;
}

.line span {
	margin-left: 24px;
}
#chart {
	
}



</style>

<template>
	<div class='line'>
		<paper-toggle-button id="toggleAnswer" on-change="redraw"></paper-toggle-button>
		<span>Antwoorden</span>
	</div>
	<div id="drawboard">
		<div id="series1"></div>
		<div id="series2"></div>
	</div>
</template>
</dom-module>
<script>
(function(){
var margin = {top: 20, right: 180, bottom: 180, left: 100},
	width = window.innerWidth  - margin.left - margin.right,
	height = window.innerHeight - margin.top - margin.bottom;

Polymer({
		is: 'imagine-reviewboard',
		properties:{
			verbindingen: {
				type: Array
			},
			verbindingen_org: {
				value: function(){return [];},
				type: Array,
			},
			kaartjes: {
				type: Array
			}
		},
		observers:[
			'itemsChanged(kaartjes,verbindingen)'
		],
		itemsChanged: function(){
			this.redraw();
		},
		redraw: function(){
			var self = this;
			var drawboard = d3.select(this.$.drawboard);
			
			/* Org events */
			var opacity = this.$.toggleAnswer.checked ? 1 : 0;
			drawboard.select('#series1').transition().style('opacity',opacity);
			
			var activeitems_org = this.kaartjes.filter(function(d){return d.data('y_org') > 50;});
			var entities_org = drawboard.select('#series1').selectAll('.event_org')
				.data(activeitems_org, function(d){return d.id()});
			var events_org = entities_org.enter().append('paper-material')
				.classed('event_org', true)
				.on('click',function(){
						drawboard.selectAll('.event').style('z-index',1).attr('elevation',1);
						d3.select(this).style('z-index',10).attr('elevation',5);
				})
				.style('left',function(d){return d.data('x_org') + '%';})
				.style('top',function(d){return 100 - (d.data('y_org') - 50) *2 + '%';})
				.html(function(d){return d.data('name');});
			
			entities_org.exit().remove();
			/*
			//Draw orig active links
			function getEvent(id){
				return self.kaartjes.filter(function(d){
					return d.data('id') == id;
				})[0];
			}
			
			var links_org = graph.select('#series1').selectAll('.link')
				.data(this.verbindingen_org, function(d){return d.id()});
			links_org.enter().append('line')
				.classed('link',true);
			
			links_org
				.attr('x1',function(d){
					return x(getEvent( d.data('vanid') ).data('x_org') );
				})
				.attr('y1',function(d){
					return y(getEvent( d.data('vanid') ).data('y_org') );
				})
				.attr('x2',function(d){
					return x(getEvent( d.data('naarid') ).data('x_org') );
				})
				.attr('y2',function(d){
					return y(getEvent( d.data('naarid') ).data('y_org') );
				});
			links_org.exit().remove();
			*/
			/*
			//Draw active links
			var active_links = this.verbindingen.filter(function(d){
					return d.data()	;
			});
			var links = graph.select('#series2').selectAll('.link')
				.data(active_links, function(d){return d.id()});
			links.enter().append('line').classed('link',true);
			links
				.attr('x1',function(d){
					return x(getEvent( d.data('vanid') ).data('x') );
				})
				.attr('y1',function(d){
					return y(getEvent( d.data('vanid') ).data('y') );
				})
				.attr('x2',function(d){
					return x(getEvent( d.data('naarid') ).data('x') );
				})
				.attr('y2',function(d){
					return y(getEvent( d.data('naarid') ).data('y') );
				});
			links.exit().remove();	
			*/
			//Draw active items
			var activeitems = this.kaartjes.filter(function(d){return d.data() && d.data().y > 50;});
			var entities = drawboard.select('#series2').selectAll('.event')
				.data(activeitems, function(d){return d.id()});
			var events = entities.enter().append('paper-material')
				.classed('event', true)
				.on('click',function(){
						drawboard.selectAll('.event')
							.style('z-index',1).attr('elevation',1);
						drawboard.selectAll('.event_org').style('z-index',1).attr('elevation',1);
						d3.select(this).style('z-index',10)
							.attr('elevation',5);
				})
				.style('left',function(d){return d.data('x') + '%';})
				.style('top',function(d){return 100 - (d.data('y') - 50) *2 + '%';})
				.html(function(d){return d.data('name');});
			entities.exit().remove();
		},
		projectChanged: function(){
		},
		attached: function(){
		}
});
})();//closure
</script>
 